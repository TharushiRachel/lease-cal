<div class="calculator-container">
  <div class="calculator-card">
    <h2>Lease Payment Calculator</h2>
    
    <div class="mode-toggle">
      <button 
        type="button" 
        (click)="toggleCalculationMode()" 
        [class.active]="!rateCalculationMode"
        class="btn btn-mode">
        Calculate Installment
      </button>
      <button 
        type="button" 
        (click)="toggleCalculationMode()" 
        [class.active]="rateCalculationMode"
        class="btn btn-mode">
        Calculate Reducing Rate (RATE)
      </button>
    </div>
    
    <form (ngSubmit)="rateCalculationMode ? calculateRate() : calculateInstallment()" class="calculator-form">
      <div class="form-group">
        <label for="capital">
          Capital (C) <span class="required">*</span>
        </label>
        <input
          type="number"
          id="capital"
          [(ngModel)]="capital"
          name="capital"
          step="0.01"
          min="0"
          placeholder="Enter capital amount"
          required
          class="form-control"
        />
      </div>

      <div class="form-group">
        <label for="interestRate">
          {{ rateCalculationMode ? 'Effective Rate (R) %' : 'Interest Rate (R) %' }} <span class="required">*</span>
        </label>
        <input
          type="number"
          id="interestRate"
          [(ngModel)]="interestRate"
          name="interestRate"
          step="0.01"
          min="0"
          placeholder="Enter annual rate (%)"
          required
          class="form-control"
        />
        <small class="form-hint">
          {{ rateCalculationMode ? 'Annual effective rate (e.g., 12 for 12% per year)' : 'Annual interest rate (e.g., 12 for 12% per year)' }}
        </small>
      </div>

      <div class="form-group">
        <label for="numberOfPeriods">
          Number of Periods (n) <span class="required">*</span>
        </label>
        <input
          type="number"
          id="numberOfPeriods"
          [(ngModel)]="numberOfPeriods"
          name="numberOfPeriods"
          step="1"
          min="1"
          placeholder="Enter number of months"
          required
          class="form-control"
        />
        <small class="form-hint">Number of months (e.g., 24 for 2 years, 36 for 3 years)</small>
      </div>

      <div class="form-group">
        <label for="upfronts">
          Upfronts (months)
        </label>
        <input
          type="number"
          id="upfronts"
          [(ngModel)]="upfronts"
          name="upfronts"
          step="1"
          min="0"
          placeholder="Enter upfront months (optional)"
          class="form-control"
        />
      </div>

      <div class="button-group">
        <button type="submit" class="btn btn-primary">
          {{ rateCalculationMode ? 'Calculate Reducing Rate' : 'Calculate Installment' }}
        </button>
        <button type="button" (click)="reset()" class="btn btn-secondary">Reset</button>
      </div>
    </form>

    <div *ngIf="!isValid" class="error-message">
      <p>{{ errorMessage }}</p>
    </div>

    <!-- Installment Calculation Results -->
    <div *ngIf="!rateCalculationMode && isValid && installmentValue > 0" class="result-section">
      <h3>Calculation Results</h3>
      <div class="result-card">
        <div class="result-item">
          <span class="result-label">Monthly Installment Value:</span>
          <span class="result-value highlight">{{ installmentValue | number:'1.2-2' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Lease Capital (C):</span>
          <span class="result-value">{{ capital | number:'1.2-2' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total Months:</span>
          <span class="result-value">{{ numberOfPeriods | number:'1.0-0' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total Amount (Monthly Installment Ã— Total Months):</span>
          <span class="result-value">{{ totalAmount | number:'1.2-2' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total Interest:</span>
          <span class="result-value">{{ totalInterest | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

    <!-- Rate Calculation Results -->
    <div *ngIf="rateCalculationMode && isValid && calculatedRate > 0" class="result-section">
      <h3>Reducing Rate Calculation Results (Excel RATE Function)</h3>
      <div class="result-card">
        <div class="result-item">
          <span class="result-label">Reducing Monthly Rate:</span>
          <span class="result-value highlight">{{ calculatedRate | number:'1.4-4' }}%</span>
        </div>
        <div class="result-item">
          <span class="result-label">Reducing Annual Rate:</span>
          <span class="result-value highlight">{{ calculatedAnnualRate | number:'1.2-2' }}%</span>
        </div>
        <div class="result-item">
          <span class="result-label">Lease Capital (C):</span>
          <span class="result-value">{{ capital | number:'1.2-2' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Monthly Installment (from effective rate):</span>
          <span class="result-value">{{ rateInstallment | number:'1.2-2' }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Number of Periods:</span>
          <span class="result-value">{{ numberOfPeriods | number:'1.0-0' }} months</span>
        </div>
      </div>
    </div>
  </div>
</div>

